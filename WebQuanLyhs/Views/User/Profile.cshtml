@model BusinessObject.Data.User
@{
	Layout = null;
}
<!DOCTYPE html>
<html>
<head>
	<title>User Profile</title>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="~/css/profile.css">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.2.1/dist/css/bootstrap.min.css" integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">
</head>

<body>
	<div class="container-xl px-4 mt-4">
		<hr class="mt-0 mb-4">
		<div class="row">
			<div class="col-xl-4">
				<!-- Profile picture card-->
				<div class="card mb-4 mb-xl-0">
					<div class="card-header">Profile Picture</div>
					@if (!string.IsNullOrEmpty(Model.Avata))
					{

						<div class="card-body text-center">
							<!-- Profile picture image-->
							<img style="max-width:70%;max-height:70%" class="img-account-profile rounded-circle mb-2" src="~/Hinh/Filenopbt/@Model.Avata" alt="">

						</div>
					}
					else
					{
						<div class="card-body text-center">
							<img style="max-width:70%;max-height:70%" class="img-account-profile rounded-circle mb-2" src="~/Hinh/Logo/user.jpg" alt="img"  />
						</div>

					}
					<div class="modal fade" id="uploadModal" tabindex="-1" role="dialog" aria-labelledby="uploadModalLabel" aria-hidden="true">
						<div class="modal-dialog" role="document">
							<div class="modal-content">
								<div class="modal-header">
									<h5 class="modal-title" id="uploadModalLabel">Upload Image</h5>
									<button type="button" class="close" data-dismiss="modal" aria-label="Close">
										<span aria-hidden="true">&times;</span>
									</button>
								</div>
							 <form id="uploadForm" asp-action="Uploadimg" enctype="multipart/form-data">
									<!-- Form upload ảnh -->
									<div class="modal-body">
										<div asp-validation-summary="ModelOnly" class="text-danger"></div>
										<input type="hidden" asp-for="User_id" id="User_id" />
										<div class="form-group">
											<label asp-for="Avata" class="control-label"></label>
											<input asp-for="Avata" type="file" class="form-control" />
											<span asp-validation-for="Avata" class="text-danger"></span>
										</div>
									</div>
									<div class="modal-footer">
										<button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
										<button type="submit" class="btn btn-primary">Upload</button> <!-- Thêm nút Upload -->
									</div>
								</form> 
							</div>
						</div>
					</div>
					<a href="#" class="btn btn-danger btnUpload" data-toggle="modal" data-target="#uploadModal" data-id="@Model.User_id">Upload Img</a>


				</div>
			</div>
			<div class="col-xl-8">
				<!-- Account details card-->
				<div class="card mb-4">
					<div class="card-header">Account Details</div>
					<div class="card-body">
						<form asp-action="EditProfile" enctype="multipart/form-data">
							<div asp-validation-summary="ModelOnly" class="text-danger"></div>
							<input type="hidden" asp-for="User_id" />
							<!-- Form Group (username)-->
							<div class="mb-3">
								<label class="small mb-1" asp-for="Fullname">Full name</label>
								<input class="form-control" asp-for="Fullname" type="text">
								<span asp-validation-for="Fullname" class="text-danger"></span>

							</div>
							<!-- Form Row  -->
							<div class="row gx-3 mb-3">
								<!-- Form Groupe-->

								<div class="col-md-6">
									<label class="small mb-1" asp-for="Sex_name">Gender</label>
									<input class="form-control" asp-for="Sex_name" type="text" value="@Model.Sex_name">
									<span asp-validation-for="Sex_name" class="text-danger"></span>

								</div>
								<!-- Form Group -->
								<div class="col-md-6">
									<label class="small mb-1" asp-for="Detail">Detail</label>
									<input class="form-control" asp-for="Detail" type="text" value="@Model.Detail">
									<span asp-validation-for="Detail" class="text-danger"></span>

								</div>
							</div>
							<!-- Form Group (email address)-->
							<div class="mb-3">
								<label class="small mb-1" asp-for="Phone">Phone</label>
								<input class="form-control" asp-for="Phone" type="text" value="@Model.Phone">
								<span asp-validation-for="Phone" class="text-danger"></span>

							</div>
							<!-- Form Row-->

							<div class="mb-3">


								<label class="small mb-1" asp-for="CCCD">CCCD</label>
								<input class="form-control" asp-for="CCCD" type="text" value="@Model.CCCD">
								<span asp-validation-for="CCCD" class="text-danger"></span>

							</div>
						</form>
					</div>
					<div class=" mx-4">

						<a class="btn btn-success" asp-action="EditProfile" asp-route-id="@Model.User_id"> Edit </a>

						@if (Model.Role_id == 1)
						{
							<a class="btn btn-danger" asp-controller="Admin" asp-action="Index">Back to List</a>
						}
						@if (Model.Role_id == 2)
						{
							<a class="btn btn-danger" asp-controller="StaffTrain" asp-action="TeacherIndex">Back to List</a>
						}
						@if (Model.Role_id == 3)
						{
							<a class="btn btn-danger" asp-controller="Teacher" asp-action="Index">Back to List</a>
						}
						@if (Model.Role_id == 4)
						{
							<a class="btn btn-danger" asp-controller="Student" asp-action="Index">Back to List</a>

						}



					</div>
				</div>
			</div>
		</div>
	</div>
	
	@section scripts {
		<script>
			$(document).ready(function () {
				// Lắng nghe sự kiện click trên nút Upload
				$('body').on('click', '.btnUpload', function () {
					// Lấy id của người dùng
					var id = $(this).data("id");

					// Hiển thị modal
					$('#uploadModal').modal('show');

					// Truyền id của người dùng vào input hidden trong modal
					$('#User_id').val(id);
				});

				// Xử lý khi người dùng gửi form
				$('#uploadForm').submit(function (event) {
					// Ngăn chặn hành động mặc định của form
					event.preventDefault();

					// Tạo formData từ form
					var formData = new FormData(this);

					// Thực hiện ajax để upload ảnh
					$.ajax({
						url: '/User/Uploadimg',
						type: 'POST',
						data: formData,
						processData: false,
						contentType: false,
						success: function (response) {
							if (response.success) {
								// Đóng modal
								$('#uploadModal').modal('hide');

								// Tải lại trang
								location.reload();
							}
						}
					});
				});
			});
		</script>
	}

	<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script>
</body>
</html>


